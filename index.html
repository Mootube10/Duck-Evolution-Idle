<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Duck Evolution Idle</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121931; --muted:#93a1bd; --text:#e9efff; --accent:#7cc5ff; --good:#7fff9f; --warn:#ffd27c; --bad:#ff8a8a;
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,sans-serif;background:radial-gradient(1200px 800px at 20% -10%,#19234a 0%,#0b1020 45%), var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:center}
    .title{font-size:28px;font-weight:800;letter-spacing:.3px}
    .stats{display:grid;grid-auto-flow:column;gap:16px;background:rgba(255,255,255,.04);padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.06)}
    .chip{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06)}
    .chip b{font-variant-numeric:tabular-nums}

    main{display:grid;grid-template-columns:1.1fr .9fr;gap:20px;margin-top:18px}
    @media (max-width: 900px){main{grid-template-columns:1fr;}}

    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .card h2{margin:0 0 12px 0;font-size:18px;color:#cfe2ff;letter-spacing:.2px}
    .card .body{padding:16px}

    .big-action{display:grid;place-items:center;aspect-ratio:1.8/1;background:linear-gradient(135deg,#1a2752,#0f1839);border-bottom:1px solid rgba(255,255,255,.08);border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .big-btn{font-size:24px;font-weight:800;padding:18px 28px;border-radius:16px;border:0;cursor:pointer;background:linear-gradient(180deg,#a7e3ff,#7cc5ff);color:#00223d;box-shadow:0 10px 30px rgba(124,197,255,.35);transition:transform .05s}
    .big-btn:active{transform:translateY(1px)}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (max-width: 640px){.grid{grid-template-columns:1fr}}
    .btn{width:100%;padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text);font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn .small{font-weight:600;opacity:.8;font-size:12px}

    .dex{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
    .duck{padding:12px;border-radius:16px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08)}
    .duck .name{font-weight:800}
    .rarity{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);opacity:.9}
    .r-Common{background:rgba(124,255,255,.06)}
    .r-Rare{background:rgba(127,255,159,.08)}
    .r-Legendary{background:rgba(255,210,124,.08)}

    footer{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;color:var(--muted);font-size:12px}
    a.link{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">ü¶Ü Duck Evolution Idle</div>
      <div class="stats">
        <div class="chip">ü•ö Eggs: <b id="eggs">0</b></div>
        <div class="chip">ü¶Ü Ducks: <b id="ducks">0</b></div>
        <div class="chip">‚ö° EPS: <b id="eps">0</b></div>
        <div class="chip">üí† Feathers: <b id="feathers">0</b></div>
      </div>
    </header>

    <main>
      <section class="card">
        <div class="big-action">
          <button id="layBtn" class="big-btn">Click to Lay Egg (+1)</button>
        </div>
        <div class="body">
          <h2>Actions</h2>
          <div class="grid">
            <button id="hatchBtn" class="btn">
              Hatch Duck ‚Äî <span id="hatchCost">10</span>ü•ö
              <div class="small">Converts eggs into a new duck</div>
            </button>
            <button id="evolveBtn" class="btn">
              Evolve Duck ‚Äî <span id="evolveCost">100</span>ü•ö
              <div class="small">Try to mutate a common into something rarer</div>
            </button>
            <button id="feederBtn" class="btn">
              Buy Feeder ‚Äî <span id="feederCost">50</span>ü•ö
              <div class="small">+0.5 passive EPS (scales 25% each)</div>
            </button>
            <button id="prestigeBtn" class="btn">
              Prestige (Rebirth)
              <div class="small">Reset for Golden Feathers (boost EPS)</div>
            </button>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="body">
          <h2>Duckdex</h2>
          <div id="dex" class="dex"></div>
        </div>
      </section>
    </main>

    <footer>
      <span>Autosaves locally. üíæ</span>
      <button id="saveBtn" class="btn" style="width:auto;padding:6px 10px">Save</button>
      <button id="resetBtn" class="btn" style="width:auto;padding:6px 10px;background:rgba(255,0,0,.12);border-color:rgba(255,0,0,.25)">Hard Reset</button>
      <span style="margin-left:auto">v0.1 ‚Äî by You</span>
    </footer>
  </div>

  <script>
    const SPECIES = [
      {id:'mallard', name:'Mallard', rarity:'Common', weight:50, eps:0.10, emoji:'üü¢'},
      {id:'pekin', name:'Pekin', rarity:'Common', weight:40, eps:0.12, emoji:'üü¢'},
      {id:'runner', name:'Runner', rarity:'Common', weight:35, eps:0.11, emoji:'üü¢'},
      {id:'golden', name:'Golden Duck', rarity:'Rare', weight:10, eps:0.50, emoji:'‚ú®'},
      {id:'robo', name:'RoboDuck', rarity:'Rare', weight:8, eps:0.60, emoji:'ü§ñ'},
      {id:'vampire', name:'Vampire Duck', rarity:'Rare', weight:6, eps:0.55, emoji:'üßõ'},
      {id:'cosmic', name:'Cosmic Duck', rarity:'Legendary', weight:1.5, eps:2.00, emoji:'üåå'},
      {id:'rex', name:'Duckosaurus Rex', rarity:'Legendary', weight:1.0, eps:2.50, emoji:'ü¶ñ'},
    ];
    const COMMON_IDS = SPECIES.filter(s=>s.rarity==='Common').map(s=>s.id);
    const RARE_IDS = SPECIES.filter(s=>s.rarity==='Rare').map(s=>s.id);
    const LEG_IDS = SPECIES.filter(s=>s.rarity==='Legendary').map(s=>s.id);

    const el = id => document.getElementById(id);

    const fmt = (n)=>{
      if(n>=1e9) return (n/1e9).toFixed(2)+'B';
      if(n>=1e6) return (n/1e6).toFixed(2)+'M';
      if(n>=1e3) return (n/1e3).toFixed(2)+'K';
      return (Math.round(n*100)/100).toString();
    };

    const defaultState = ()=>({
      eggs:0,
      feeders:0,
      feathers:0,
      totalHatched:0,
      speciesCounts:Object.fromEntries(SPECIES.map(s=>[s.id,0])),
      lastTick:Date.now(),
    });

    let state = load();

    function load(){
      try{
        const raw = localStorage.getItem('duckidle.save');
        if(!raw) return defaultState();
        const s = JSON.parse(raw);
        // migrate
        const base = defaultState();
        return Object.assign(base, s, {
          speciesCounts: Object.assign(base.speciesCounts, s.speciesCounts||{})
        });
      }catch(e){
        console.warn('Save load failed', e);
        return defaultState();
      }
    }
    function save(){
      localStorage.setItem('duckidle.save', JSON.stringify(state));
    }

    function totalDucks(){
      return Object.values(state.speciesCounts).reduce((a,b)=>a+b,0);
    }

    function currentEPS(){
      const feathersBoost = 1 + state.feathers*0.1; // +10% per feather
      const ducksEPS = SPECIES.reduce((sum,s)=> sum + state.speciesCounts[s.id]*s.eps, 0);
      const feedersEPS = state.feeders * 0.5;
      return (ducksEPS + feedersEPS) * feathersBoost;
    }

    function weightedPick(ids){
      const pool = SPECIES.filter(s=>ids.includes(s.id));
      const sum = pool.reduce((a,s)=>a+s.weight,0);
      let r = Math.random()*sum;
      for(const s of pool){
        if((r-=s.weight)<=0) return s.id;
      }
      return pool[pool.length-1].id;
    }

    function hatchDuck(){
      const cost = hatchCost();
      if(state.eggs < cost) return false;
      state.eggs -= cost;
      // Hatch: mostly commons, rare chance baked into weights
      const id = weightedPick(SPECIES.map(s=>s.id));
      state.speciesCounts[id]++;
      state.totalHatched++;
      return id;
    }

    function hatchCost(){
      const base = 10;
      // mild scaling with total ducks to keep pacing
      return Math.floor(base + Math.max(0, totalDucks()-10)*0.5);
    }

    function evolveDuck(){
      const cost = evolveCost();
      if(state.eggs < cost) return {ok:false, reason:'Need more eggs'};
      // must have at least 1 common
      const commonCount = COMMON_IDS.reduce((a,id)=>a+state.speciesCounts[id],0);
      if(commonCount<=0) return {ok:false, reason:'No common ducks to evolve'};
      state.eggs -= cost;
      // 65% chance -> Rare, 12% -> Legendary, else failed mutation into different Common
      const roll = Math.random();
      if(roll < 0.12){
        const target = weightedPick(LEG_IDS);
        // consume one common
        consumeOne(COMMON_IDS);
        state.speciesCounts[target]++;
        return {ok:true, tier:'Legendary', id:target};
      }else if(roll < 0.77){
        const target = weightedPick(RARE_IDS);
        consumeOne(COMMON_IDS);
        state.speciesCounts[target]++;
        return {ok:true, tier:'Rare', id:target};
      }else{
        const target = weightedPick(COMMON_IDS);
        consumeOne(COMMON_IDS);
        state.speciesCounts[target]++;
        return {ok:true, tier:'Common', id:target, downgraded:true};
      }
    }

    function consumeOne(idList){
      // remove one duck from the first available id in list
      for(const id of idList){
        if(state.speciesCounts[id]>0){ state.speciesCounts[id]--; return; }
      }
    }

    function evolveCost(){
      return Math.floor(100 + totalDucks()*2);
    }

    function feederCost(){
      return Math.floor(50 * Math.pow(1.25, state.feeders));
    }

    function prestigeAvailable(){
      return totalDucks() >= 100;
    }

    function doPrestige(){
      if(!prestigeAvailable()) return false;
      const feathersGain = Math.floor(totalDucks()/100);
      if(!confirm(`Prestige for ${feathersGain} Golden Feather(s)? This resets eggs, ducks and feeders.`)) return false;
      state = defaultState();
      state.feathers += feathersGain;
      save();
      return true;
    }

    // UI Wiring
    const eggsEl = el('eggs');
    const ducksEl = el('ducks');
    const epsEl = el('eps');
    const feathersEl = el('feathers');
    const dexEl = el('dex');

    function renderStats(){
      eggsEl.textContent = fmt(state.eggs);
      ducksEl.textContent = fmt(totalDucks());
      epsEl.textContent = fmt(currentEPS());
      feathersEl.textContent = fmt(state.feathers);
      el('hatchCost').textContent = fmt(hatchCost());
      el('evolveCost').textContent = fmt(evolveCost());
      el('feederCost').textContent = fmt(feederCost());
    }

    function renderDex(){
      dexEl.innerHTML = '';
      SPECIES.forEach(s=>{
        const count = state.speciesCounts[s.id];
        const div = document.createElement('div');
        div.className = 'duck';
        div.innerHTML = `
          <div class="name">${s.emoji} ${s.name}</div>
          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:6px">
            <span class="rarity r-${s.rarity}">${s.rarity}</span>
            <span>Count: <b>${fmt(count)}</b></span>
          </div>
          <div style="margin-top:6px;opacity:.85">EPS each: ${s.eps}</div>
        `;
        dexEl.appendChild(div);
      });
    }

    // Actions
    el('layBtn').addEventListener('click', ()=>{ state.eggs += 1; renderStats(); });

    el('hatchBtn').addEventListener('click', ()=>{
      const id = hatchDuck();
      if(!id) return;
      flash(`Hatched a ${SPECIES.find(s=>s.id===id).name}!`);
      renderStats();
      renderDex();
    });

    el('evolveBtn').addEventListener('click', ()=>{
      const res = evolveDuck();
      if(!res.ok){ flash(res.reason,'warn'); return; }
      const s = SPECIES.find(x=>x.id===res.id);
      flash(`Mutation success ‚ûú ${s.name} (${s.rarity})`);
      renderStats();
      renderDex();
    });

    el('feederBtn').addEventListener('click', ()=>{
      const cost = feederCost();
      if(state.eggs < cost){ flash('Not enough eggs','warn'); return; }
      state.eggs -= cost;
      state.feeders++;
      flash('Bought a Feeder (+0.5 EPS)');
      renderStats();
    });

    el('prestigeBtn').addEventListener('click', ()=>{
      if(!prestigeAvailable()) { flash('Need at least 100 total ducks to prestige','warn'); return; }
      if(doPrestige()){
        flash('Prestiged! Golden Feathers boost your EPS by +10% each.','good');
        renderStats();
        renderDex();
      }
    });

    el('saveBtn').addEventListener('click', ()=>{ save(); flash('Saved!','good'); });
    el('resetBtn').addEventListener('click', ()=>{
      if(confirm('Hard reset? This clears your progress.')){
        state = defaultState();
        save();
        renderStats();
        renderDex();
        flash('Progress wiped.','bad');
      }
    });

    // Toasts
    const toastQ = [];
    function flash(msg,type='info'){
      const n = document.createElement('div');
      n.textContent = msg;
      n.style.position='fixed';n.style.left='50%';n.style.transform='translateX(-50%)';
      n.style.bottom = (20 + toastQ.length*44)+'px';
      n.style.background = type==='good'? 'rgba(127,255,159,.18)': type==='warn'? 'rgba(255,210,124,.18)': type==='bad'? 'rgba(255,138,138,.2)': 'rgba(124,197,255,.18)';
      n.style.border='1px solid rgba(255,255,255,.18)';
      n.style.color='var(--text)';n.style.padding='10px 14px';n.style.borderRadius='999px';n.style.backdropFilter='blur(6px)';
      n.style.zIndex=9999; n.style.fontWeight=700; n.style.boxShadow='0 10px 30px rgba(0,0,0,.35)';
      document.body.appendChild(n); toastQ.push(n);
      setTimeout(()=>{ n.style.transition='all .25s'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(10px)'; }, 1600);
      setTimeout(()=>{ document.body.removeChild(n); toastQ.shift(); }, 1900);
    }
const ACHIEVEMENTS = [
  { id: "firstDuck",   name: "First Duck!", desc: "Hatch your very first duck", check: () => totalDucks() >= 1 },
  { id: "eggFarmer",   name: "Egg Farmer",  desc: "Lay 1,000 eggs",             check: () => state.eggs >= 1000 },
  { id: "flockMaster", name: "Flock Master",desc: "Own 50 ducks",               check: () => totalDucks() >= 50 },
  { id: "prestiger",   name: "The Cycle",   desc: "Perform a prestige",         check: () => state.feathers > 0 },
  // üëâ Add your own here
];

function defaultAchievements() {
  return Object.fromEntries(ACHIEVEMENTS.map(a => [a.id, false]));
}

// Merge with save data
if (!state.achievements) {
  state.achievements = defaultAchievements();
}

// Check achievements each frame
function checkAchievements() {
  for (const a of ACHIEVEMENTS) {
    if (!state.achievements[a.id] && a.check()) {
      unlockAchievement(a);
    }
  }
}

function unlockAchievement(a) {
  state.achievements[a.id] = true;
  save();
  flash(`üèÜ Achievement Unlocked: ${a.name}`, "good");
}

// Hook into your game loop
const oldTick = tick;
function tickWrapper() {
  oldTick();
  checkAchievements();
}
tick = tickWrapper;

    // Game Loop
    function tick(){
      const now = Date.now();
      const dt = Math.min(1, (now - state.lastTick)/1000); // cap to 1s to avoid massive jumps
      state.lastTick = now;
      // Passive egg gain
      state.eggs += currentEPS()*dt;
      renderStats();
      requestAnimationFrame(tick);
    }

    // Autosave
    setInterval(save, 10000);

    // Initial render
    renderStats();
    renderDex();
    state.lastTick = Date.now();
    tick();
  </script>
</body>
</html>

